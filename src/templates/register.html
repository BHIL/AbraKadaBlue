<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Abra KadaBlue</title>

    <link rel="icon" href="/static/frontend/sprites/ui/faveicon_blue_hat_02.png">

    <script type="text/javascript">
        !function (T, l, y) { var S = T.location, k = "script", D = "instrumentationKey", C = "ingestionendpoint", I = "disableExceptionTracking", E = "ai.device.", b = "toLowerCase", w = "crossOrigin", N = "POST", e = "appInsightsSDK", t = y.name || "appInsights"; (y.name || T[e]) && (T[e] = t); var n = T[t] || function (d) { var g = !1, f = !1, m = { initialize: !0, queue: [], sv: "5", version: 2, config: d }; function v(e, t) { var n = {}, a = "Browser"; return n[E + "id"] = a[b](), n[E + "type"] = a, n["ai.operation.name"] = S && S.pathname || "_unknown_", n["ai.internal.sdkVersion"] = "javascript:snippet_" + (m.sv || m.version), { time: function () { var e = new Date; function t(e) { var t = "" + e; return 1 === t.length && (t = "0" + t), t } return e.getUTCFullYear() + "-" + t(1 + e.getUTCMonth()) + "-" + t(e.getUTCDate()) + "T" + t(e.getUTCHours()) + ":" + t(e.getUTCMinutes()) + ":" + t(e.getUTCSeconds()) + "." + ((e.getUTCMilliseconds() / 1e3).toFixed(3) + "").slice(2, 5) + "Z" }(), iKey: e, name: "Microsoft.ApplicationInsights." + e.replace(/-/g, "") + "." + t, sampleRate: 100, tags: n, data: { baseData: { ver: 2 } } } } var h = d.url || y.src; if (h) { function a(e) { var t, n, a, i, r, o, s, c, u, p, l; g = !0, m.queue = [], f || (f = !0, t = h, s = function () { var e = {}, t = d.connectionString; if (t) for (var n = t.split(";"), a = 0; a < n.length; a++) { var i = n[a].split("="); 2 === i.length && (e[i[0][b]()] = i[1]) } if (!e[C]) { var r = e.endpointsuffix, o = r ? e.location : null; e[C] = "https://" + (o ? o + "." : "") + "dc." + (r || "services.visualstudio.com") } return e }(), c = s[D] || d[D] || "", u = s[C], p = u ? u + "/v2/track" : d.endpointUrl, (l = []).push((n = "SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)", a = t, i = p, (o = (r = v(c, "Exception")).data).baseType = "ExceptionData", o.baseData.exceptions = [{ typeName: "SDKLoadFailed", message: n.replace(/\./g, "-"), hasFullStack: !1, stack: n + "\nSnippet failed to load [" + a + "] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: " + (S && S.pathname || "_unknown_") + "\nEndpoint: " + i, parsedStack: [] }], r)), l.push(function (e, t, n, a) { var i = v(c, "Message"), r = i.data; r.baseType = "MessageData"; var o = r.baseData; return o.message = 'AI (Internal): 99 message:"' + ("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) (" + n + ")").replace(/\"/g, "") + '"', o.properties = { endpoint: a }, i }(0, 0, t, p)), function (e, t) { if (JSON) { var n = T.fetch; if (n && !y.useXhr) n(t, { method: N, body: JSON.stringify(e), mode: "cors" }); else if (XMLHttpRequest) { var a = new XMLHttpRequest; a.open(N, t), a.setRequestHeader("Content-type", "application/json"), a.send(JSON.stringify(e)) } } }(l, p)) } function i(e, t) { f || setTimeout(function () { !t && m.core || a() }, 500) } var e = function () { var n = l.createElement(k); n.src = h; var e = y[w]; return !e && "" !== e || "undefined" == n[w] || (n[w] = e), n.onload = i, n.onerror = a, n.onreadystatechange = function (e, t) { "loaded" !== n.readyState && "complete" !== n.readyState || i(0, t) }, n }(); y.ld < 0 ? l.getElementsByTagName("head")[0].appendChild(e) : setTimeout(function () { l.getElementsByTagName(k)[0].parentNode.appendChild(e) }, y.ld || 0) } try { m.cookie = l.cookie } catch (p) { } function t(e) { for (; e.length;)!function (t) { m[t] = function () { var e = arguments; g || m.queue.push(function () { m[t].apply(m, e) }) } }(e.pop()) } var n = "track", r = "TrackPage", o = "TrackEvent"; t([n + "Event", n + "PageView", n + "Exception", n + "Trace", n + "DependencyData", n + "Metric", n + "PageViewPerformance", "start" + r, "stop" + r, "start" + o, "stop" + o, "addTelemetryInitializer", "setAuthenticatedUserContext", "clearAuthenticatedUserContext", "flush"]), m.SeverityLevel = { Verbose: 0, Information: 1, Warning: 2, Error: 3, Critical: 4 }; var s = (d.extensionConfig || {}).ApplicationInsightsAnalytics || {}; if (!0 !== d[I] && !0 !== s[I]) { var c = "onerror"; t(["_" + c]); var u = T[c]; T[c] = function (e, t, n, a, i) { var r = u && u(e, t, n, a, i); return !0 !== r && m["_" + c]({ message: e, url: t, lineNumber: n, columnNumber: a, error: i }), r }, d.autoExceptionInstrumented = !0 } return m }(y.cfg); function a() { y.onInit && y.onInit(n) } (T[t] = n).queue && 0 === n.queue.length ? (n.queue.push(a), n.trackPageView({})) : a() }(window, document, {
            src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", // The SDK URL Source
            // name: "appInsights", // Global SDK Instance name defaults to "appInsights" when not supplied
            // ld: 0, // Defines the load delay (in ms) before attempting to load the sdk. -1 = block page load and add to head. (default) = 0ms load after timeout,
            // useXhr: 1, // Use XHR instead of fetch to report failures (if available),
            crossOrigin: "anonymous", // When supplied this will add the provided value as the cross origin attribute on the script tag
            // onInit: null, // Once the application insights instance has loaded and initialized this callback function will be called with 1 argument -- the sdk instance (DO NOT ADD anything to the sdk.queue -- As they won't get called)
            cfg: { // Application Insights Configuration
                instrumentationKey: "d91281b0-7375-417d-9261-6dd854be625d"
            }
        });
    </script>

    <style>
        html,
        body {
            height: 100%;
            width: 100%;
        }

        body {
            background-color: #060606 !important;
            color: #d4d4d4;
            line-height: 34px;
            font-size: 19px;
            font-family: 'Segoe UI Light', 'Segoe UI';
            font-weight: lighter;
            margin: 0;
            overflow: hidden;
        }

        input[type="text"],
        input[type="email"] {
            background: transparent;
            border: none;
            border-bottom: 1px #f4c845 inset;
            font-size: 1em;
            font-family: LanaPixel;
            color: #d4d4d4;
        }

        :focus {
            outline: none;
            text-shadow: 0px 0px 4px #00adee;
            color: #00adee !important;
        }


        div.stretchy-wrapper {
            width: 100%;
            height: 56.25vw;
            max-height: 100vh;
            max-width: 177.78vh;
            margin: auto;
            position: relative;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        div.stretchy-wrapper>iframe {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #character-info {
            text-align: center;
            font-family: LanaPixel;
            width: 40%;
            font-size: 2.5vh;
        }
    </style>

    <link rel="stylesheet" href="/static/frontend/css/app.css" />
</head>

<body>
    <!-- jQuery 3.6.0 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        let selectedCharacter;
        const characterInfos = {
            rusty: {
                name: "Rusty",
                description: "The newest member of the league and a magical prodigy. Sheâ€™s on a lifelong quest to retrieve her lost nose."
            },
            crusty: {
                name: "Crusty",
                description: "A veteran member of the league. His impressive beard has stood the test of time and is considered a magical treasure."
            }
        };

        function selectCharacter(character) {
            $(".selected-character").removeClass("selected-character");
            $(`#${character}-selection`).addClass("selected-character");
            selectedCharacter = character;
        }

        function validateForm() {
            const form = document.forms["characterSelection"];
            const invalidInputs = Array.from(form.querySelectorAll(":invalid"))
            if (invalidInputs.length && invalidInputs.every(i => i.name === "character")) {
                alert("Please select a character");
            }
        }

        function onClickRegister() {
            const root = $("#content-root");
            root.empty()
            const container = $(`
                <div style="width: calc(100% - 60px); height: calc(100% - 60px); padding: 30px;">
                    <div id="preloadedImages"></div>
                </div>
            `)
            const form = $(`
                <form 
                    name="characterSelection" 
                    action="/register" 
                    method="POST" 
                    onsubmit="validateForm()" 
                    style="height: 100%; display: flex; flex-direction: column; justify-content: space-between;"
                ></form>`)
            const inputs = $(`
                <div>
                    <p style="font-size: 3vh; text-align: center; font-family: LanaPixel;">
                        Hello <input type="text" id="nickname" name="nickname" placeholder="Nickname" required /> !
                        <br style="
                            display: block;
                            line-height: 1.5vh;
                            margin: 1.5vh 0;
                            content: ' ';
                        " />
                        Welcome to the Abra KadaBlue league of wizards!
                        <br style="
                            display: block;
                            line-height: 1.5vh;
                            margin: 1.5vh 0;
                            content: ' ';
                        " />
                        If you are the one who saves the Fluff Kingdom, how can we contact you? <input type="email" id="email" name="email" placeholder="crusty@kadablue.com" required />
                        <br style="
                            display: block;
                            line-height: 1.5vh;
                            margin: 1.5vh 0;
                            content: ' ';
                        " />
                        Please select your wizard:
                    </p>
                </div>
            `)
            const characterSelection = $(`
                <div style="display: flex; flex-direction: row; justify-content: center;">
                    <div>
                        <label id="rusty-selection">
                            <input type="radio" name="character" value="Rusty" onclick="selectCharacter('rusty')" style="visibility: hidden; position: absolute;" required />
                            <div class="character-sprite"></div>
                        </label>
                    </div>
                    <div id="character-info"></div>
                    <div>
                        <label id="crusty-selection">
                            <input type="radio" name="character" value="Crusty" onclick="selectCharacter('crusty')" style="visibility: hidden; position: absolute;" required />
                            <div class="character-sprite"></div>
                        </label>
                    </div>
                </div>
            `)
            const submitButton = $(`
                <div style="display: flex; justify-content: center; margin: 15px;">
                    <input id="lets-rock-button" class="button" type="submit" value="" onclick=validateForm() />
                </div>
            `)
            form.append(inputs)
            form.append(characterSelection)
            form.append(submitButton)
            container.append(form);
            root.append(container);
            const characterInfo = $("#character-info");

            function setCharacterInfo(character) {
                characterInfo.empty();
                if (character) {
                    characterInfo.append(`
                    <h3 style="color: rebeccapurple">${characterInfos[character].name}</h3>
                    <p>${characterInfos[character].description}</p>
                    `);
                }
            }
            $("#rusty-selection").hover(
                () => {
                    setCharacterInfo("rusty");
                },
                () => {
                    setCharacterInfo(selectedCharacter);
                });
            $("#crusty-selection").hover(
                () => {
                    setCharacterInfo("crusty");
                },
                () => {
                    setCharacterInfo(selectedCharacter);
                });
        }

        function getVideoElement() {
            const wrapper = $('<div class="stretchy-wrapper"></div>')
            wrapper.append($('<iframe src="https://www.youtube-nocookie.com/embed/k6S15kaOHCg" title="YouTube video player" frameborder="0" allow="fullscreen; accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>'));
            return wrapper;
        }
        function onClickStart() {
            const root = $("#content-root")
            root.empty()
            root.addClass("login-background")
            const videoContainer = $(`
                <div style="width: calc(100% - 60px); height: calc(100% - 60px); padding: 30px; display: flex; flex-direction: column;"></div>
            `);
            root.append(videoContainer);
            videoContainer.append(getVideoElement());
            videoContainer.append($(`
                <div style="display: flex; justify-content: center; margin: 15px;">
                    <button id="register-button" class="button" onclick="onClickRegister()"></button>
                </div>
            `))
        }
    </script>


    <div id="content-root" style="height: 100%; width: 100%;">
        <div id="intro-screen">
            <button id="intro-button" class="button" onclick="onClickStart()"></button>
        </div>
    </div>
</body>

</html>
